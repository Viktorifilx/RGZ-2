{% extends "base.html" %}

{% block title %}{{ street.name }} ‚Äî —è—Ä–º–∞—Ä–∫–∞{% endblock %}

{% block content %}
<section class="street-hero">
    <a href="{{ url_for('index') }}" class="back-link">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —è—Ä–º–∞—Ä–æ—á–Ω—É—é –ø–ª–æ—â–∞–¥—å</a>
    <h1>{{ street.name }}</h1>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–º–∏–∫-–ø–∞–≤–∏–ª—å–æ–Ω –≤–¥–æ–ª—å –¥–æ—Ä–æ–∂–∫–∏ üëá</p>
</section>

<section class="street-map-section">
    <div class="street-map">
        <!-- —Ñ–æ–Ω —É–ª–∏—Ü—ã -->
        <img
            src="{{ url_for('static', filename='images/street_bg.png') }}"
            alt="–ö–∞—Ä—Ç–∞ —É–ª–∏—Ü—ã"
            class="street-bg"
        >

        <!-- —Å–ª–æ–π —Å –ø–∞–ª–∞—Ç–∫–∞–º–∏ -->
        <div class="pavilions-layer">
            {% set max_slots = 5 %}
            {% set pav_list = pavilions[:max_slots] %}

            {% for slot in range(1, max_slots + 1) %}
                {% set pav = pav_list[loop.index0] if loop.index0 < pav_list|length else None %}

                {% if pav %}
                    <a href="{{ url_for('pavilion_page', pavilion_id=pav.id) }}"
                       class="pavilion slot-{{ slot }} has-ad">
                        <div class="pavilion-inner">
                            <img src="{{ url_for('static', filename='icons/house.PNG') }}"
                                 alt="–ü–∞–≤–∏–ª—å–æ–Ω"
                                 class="pavilion-img">
                            <div class="pavilion-badge">
                                <div class="pavilion-title">{{ pav.title }}</div>
                                <div class="pavilion-master">
                                    –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π: {{ pav.ads|length }}
                                </div>
                            </div>
                        </div>
                    </a>
                {% else %}
                    <div class="pavilion slot-{{ slot }} empty">
                        <div class="pavilion-inner">
                            <img src="{{ url_for('static', filename='icons/house.PNG') }}"
                                 alt="–°–≤–æ–±–æ–¥–Ω—ã–π –ø–∞–≤–∏–ª—å–æ–Ω"
                                 class="pavilion-img">
                            <div class="pavilion-badge">
                                <div class="pavilion-title">–°–≤–æ–±–æ–¥–Ω—ã–π –ø–∞–≤–∏–ª—å–æ–Ω</div>
                                <div class="pavilion-master">–ú–µ—Å—Ç–æ –¥–ª—è –Ω–æ–≤–æ–π —Ç–µ–º—ã</div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
</section>

<!-- –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ -->
<button class="support-fab" id="support-fab" type="button">
    ?
</button>

<!-- –ù–µ–±–æ–ª—å—à–æ–π –≤–∏–¥–∂–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–ø—Ä–∞–≤–∞ —Å–Ω–∏–∑—É -->
<div class="support-widget" id="support-widget">
    <div class="support-widget-inner">
        <div class="support-header">
            <div>
                <div class="support-title">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —è—Ä–º–∞—Ä–∫–∏</div>
                <div class="support-subtitle">
                    –ö–æ—Ä–æ—Ç–∫–∏–π –≤–æ–ø—Ä–æ—Å? –ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º üëã
                </div>
            </div>
            <button class="support-close" id="support-close" type="button">√ó</button>
        </div>

        <div class="support-problems">
            <button class="support-problem-btn active"
                    data-template="–ú–Ω–µ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å —Ä–∞–±–æ—Ç–æ–π —Å–∞–π—Ç–∞ (–æ—à–∏–±–∫–∞/—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è).">
                –ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–∞–π—Ç–æ–º
            </button>
            <button class="support-problem-btn"
                    data-template="–•–æ—á—É —É—Ç–æ—á–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å –ø–æ —Ä–∞–±–æ—Ç–µ —è—Ä–º–∞—Ä–∫–∏ –∏ –ø–∞–≤–∏–ª—å–æ–Ω–æ–≤.">
                –í–æ–ø—Ä–æ—Å –ø–æ —è—Ä–º–∞—Ä–∫–µ
            </button>
            <button class="support-problem-btn"
                    data-template="–•–æ—á—É –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è –Ω–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ (—Å–ø–∞–º/–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç).">
                –ñ–∞–ª–æ–±–∞ –Ω–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
            </button>
            <button class="support-problem-btn"
                    data-template="–î—Ä—É–≥–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ.">
                –î—Ä—É–≥–æ–µ
            </button>
        </div>

        <label class="support-text-label">
            –í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            <textarea id="support-textarea" class="support-textarea"
                      placeholder="–ö–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –∏–ª–∏ –≤–æ–ø—Ä–æ—Å"></textarea>
        </label>

        <div class="support-actions">
            <button class="btn btn-primary support-send" id="support-send" type="button">
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å (–¥–µ–º–æ)
            </button>
            <span class="support-note">
                –≠—Ç–æ –¥–µ–º–æ: —Ç–µ–∫—Å—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä, —Ç–æ–ª—å–∫–æ –∏–º–∏—Ç–∞—Ü–∏—è —á–∞—Ç–∞ üôÇ
            </span>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const fab = document.getElementById('support-fab');
    const widget = document.getElementById('support-widget');
    const closeBtn = document.getElementById('support-close');
    const problemButtons = document.querySelectorAll('.support-problem-btn');
    const textarea = document.getElementById('support-textarea');
    const sendBtn = document.getElementById('support-send');

    const STORAGE_KEY = 'fair_support_shown';

    function openSupport() {
        widget.classList.add('is-open');
    }

    function closeSupport() {
        widget.classList.remove('is-open');
    }

    if (!sessionStorage.getItem(STORAGE_KEY)) {
        openSupport();
        sessionStorage.setItem(STORAGE_KEY, '1');
    }

    fab.addEventListener('click', function () {
        if (widget.classList.contains('is-open')) {
            closeSupport();
        } else {
            openSupport();
        }
    });

    closeBtn.addEventListener('click', closeSupport);

    problemButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            problemButtons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const template = btn.getAttribute('data-template') || '';
            textarea.value = template;
            textarea.focus();
            textarea.selectionStart = textarea.selectionEnd = textarea.value.length;
        });
    });

    sendBtn.addEventListener('click', () => {
        if (!textarea.value.trim()) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ —Ö–æ—Ç—è –±—ã –ø–∞—Ä—É —Å–ª–æ–≤ üôÇ');
            return;
        }
        alert('–°–ø–∞—Å–∏–±–æ! –í —Ä–µ–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ —ç—Ç–æ —É—à–ª–æ –±—ã –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É:\n\n' + textarea.value.trim());
        closeSupport();
    });
});
</script>
{% endblock %}
