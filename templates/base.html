<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>{% block title %}üé™ –Ø—Ä–º–∞—Ä–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon.ico') }}">


    <style>
        .msg-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff4fd8, #ff9a3c);
            color: #fff;
            padding: 2px 6px;
            font-size: 11px;
            border-radius: 999px;
            margin-left: 6px;
            font-weight: 600;
            line-height: 1;
        }
    </style>

    {% block extra_head %}{% endblock %}
</head>
<body>
<header class="site-header">
    <div class="logo">
        üé™ <span>FairMarket</span>
    </div>

    <nav class="main-nav">
        <a href="{{ url_for('index') }}">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="{{ url_for('index') }}#streets">–£–ª–∏—Ü—ã</a>
        <a href="{{ url_for('about') }}">–û —è—Ä–º–∞—Ä–∫–µ</a>

        {% if session.get('user_id') %}
            <a href="{{ url_for('support') }}">
                –ü–æ–¥–¥–µ—Ä–∂–∫–∞
                {% if session.get('support_unread', 0) > 0 %}
                    <span class="msg-badge">
                        {{ session.get('support_unread') }}
                    </span>
                {% endif %}
            </a>
        {% endif %}


        {# –°—Å—ã–ª–∫–∞ "–°–æ–æ–±—â–µ–Ω–∏—è" –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è #}
        {% if session.get('user_role') == 'master' %}
            <a href="{{ url_for('ad_messages') }}" class="nav-messages-link">
                –°–æ–æ–±—â–µ–Ω–∏—è
                {% if session.get('unread_total', 0) > 0 %}
                    <span class="msg-badge">{{ session.get('unread_total') }}</span>
                {% endif %}
            </a>
        {% elif session.get('user_role') == 'user' %}
            <a href="{{ url_for('user_messages') }}" class="nav-messages-link">
                –°–æ–æ–±—â–µ–Ω–∏—è
                {% if session.get('unread_total', 0) > 0 %}
                    <span class="msg-badge">{{ session.get('unread_total') }}</span>
                {% endif %}
            </a>
        {% endif %}
    </nav>

    <div class="auth-block header-auth">
        {% if session.get('user_id') %}
            <span class="user-chip">
                <span class="user-avatar">
                    {{ session.get('username', '?')[0] | upper }}
                </span>
                <span class="user-name">
                    {{ session.get('username', '–ì–æ—Å—Ç—å') }}
                    {% if session.get('user_role') == 'master' %}
                        ¬∑ –º–∞—Å—Ç–µ—Ä
                    {% elif session.get('user_role') == 'admin' %}
                        ¬∑ –∞–¥–º–∏–Ω
                    {% endif %}
                </span>
            </span>
            <a href="{{ url_for('logout') }}" class="btn btn-outline">
                –í—ã–π—Ç–∏
            </a>
        {% else %}
            <a href="{{ url_for('login') }}" class="btn btn-outline">
                –í–æ–π—Ç–∏
            </a>
            <a href="{{ url_for('register') }}" class="btn btn-primary">
                –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
            </a>
        {% endif %}
    </div>
</header>

<main class="page-content">
    {% block content %}{% endblock %}
</main>

<footer class="site-footer">
    <div class="footer-inner">
        <span>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: {{ fio|default('–§–∏–ª–∞—Ç–æ–≤–∞ –í–∏–∫—Ç–æ—Ä–∏—è') }}</span>
        <span>–ì—Ä—É–ø–ø–∞: {{ group|default('–§–ë–ò-34') }}</span>
        <span>–ü—Ä–æ–µ–∫—Ç: "–¶–∏—Ñ—Ä–æ–≤–∞—è —è—Ä–º–∞—Ä–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤"</span>
    </div>
</footer>

{% if session.get('user_role') == 'user' and session.get('unread_total', 0) > 0 %}
<style>
    .floating-messages {
        position: fixed;
        right: 18px;
        bottom: 18px;
        z-index: 50;
        background: #111827;
        color: #f9fafb;
        border-radius: 18px;
        padding: 10px 14px;
        box-shadow: 0 18px 40px rgba(15,23,42,0.45);
        max-width: 260px;
        font-size: 13px;
    }
    .floating-messages-title {
        font-weight: 700;
        margin-bottom: 4px;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    .floating-messages-count {
        display: inline-block;
        padding: 1px 6px;
        border-radius: 999px;
        background: linear-gradient(135deg,#ff4fd8,#ff9a3c);
        font-size: 11px;
        font-weight: 600;
    }
    .floating-messages-text {
        margin-bottom: 8px;
        color: #e5e7eb;
    }
    .floating-messages a {
        display: inline-block;
        font-size: 12px;
        padding: 4px 10px;
        border-radius: 999px;
        background: #f9fafb;
        color: #111827;
        text-decoration: none;
        font-weight: 600;
    }
</style>

<div class="floating-messages">
    <div class="floating-messages-title">
        –ù–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        <span class="floating-messages-count">
            +{{ session.get('unread_total', 0) }}
        </span>
    </div>
    <div class="floating-messages-text">
        –£ –≤–∞—Å –µ—Å—Ç—å –Ω–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –æ—Ç –º–∞—Å—Ç–µ—Ä–æ–≤. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å.
    </div>
    <a href="{{ url_for('user_messages') }}">–û—Ç–∫—Ä—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è</a>
</div>
{% endif %}

<script>
    {% block extra_scripts %}{% endblock %}
</script>
</body>
</html>
